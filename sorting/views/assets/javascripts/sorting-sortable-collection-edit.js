"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery")):t(jQuery)}(function(p){var n="qor.collection.sortable",t="enable."+n,e="click."+n,d="> .qor-field__block > .qor-sortable__item",a=">.qor-sortable__button > .qor-sortable__button-change",l=">.qor-sortable__button > .qor-sortable__button-done",c="> .qor-field__block > .qor-sortable__button-add",f="> .qor-sortable__button-delete",o=">.qor-field__block > .qor-sortable__item > .qor-sortable__change .qor-sortable__button-move",_="> .qor-sortable__change > .qor-sortable__action",s=".qor-sortable__action-position",y=".is-delete,.qor-fieldset--new",i="sortable-collection-loaded";function v(t,e){this.$element=p(t),this.options=p.extend({},v.DEFAULTS,p.isPlainObject(e)&&e),this.init()}return v.prototype={constructor:v,init:function(){this.bind(),this.initItemOrder()},bind:function(){this.$element.on(e,o,this.moveItem.bind(this)).on(e,l,this.finishMoveItem.bind(this)).on(e,a,this.startMoveItem.bind(this)),p(document).on("added.qor.replicator.sortableCollection",this.resetOrderArr.bind(this))},unbind:function(){this.$element.off(e,o).off(e,l).off(e,a),p(document).off("added.qor.replicator.sortableCollection")},initItemOrder:function(f){var t=this.$element.find(d).not(y);if(t.length){var e,h,o=(this.$item=t).find(_).find(s),u={},m=[],b=t.length,i=t.first().html();o.length&&o.remove(),h||(e=i.match(/(\w+)\="(\S*\[\d+\]\S*)"/)).length&&(e=e[2],(h=e.match(/^(\S*)\[(\d+)\]([^\[\]]*)$/)).length&&(h=h[1])),t.each(function(){var t=p(this),e=t.find(_),o=parseInt(t.attr("order-index"));u.itemTotal=b,u.itemIndex=o,m.push(o),e.prepend('<select class="qor-sortable__action-position"></select>');for(var i=1;i<=b;i++){var n,r=void 0;r=o+1==i,n=p.extend({},u,{selectorPosition:i,isSelected:r}),e.find("select").append(window.Mustache.render(v.OPTION_HTML,n))}if(f){var s,d,a,l=/\[\d+\]/.test(h),c=p(this).find('[name^="'+h+'"]');if(!c.length)return;c.each(function(){s=p(this).prop("name"),a=s.match(/\.\w+$/),d="[".concat(o,"]"),s=l?s.replace(/\[\d+\]\.\w+$/,"".concat(d).concat(a)):s.replace(/\[\d+\]/,d),p(this).prop("name",s)})}t.data(u)}),this.itemOrderArr=this.itemOrderArr||m}},resetOrderArr:function(t,e){var o=parseInt(e.attr("order-index"));o&&(this.itemOrderArr=this.itemOrderArr||[],this.itemOrderArr.push(o),this.$item=this.$element.find(d).not(y))},moveItem:function(t){var e=p(t.target).closest(".qor-sortable__item"),o=e.data().itemIndex,i=parseInt(e.find(s).val())-1,n=this.$item,r=[];i!=o&&((r=function(t,e,o){if(o>=t.length)for(var i=o-t.length;1+i--;)t.push(void 0);return t.splice(o,0,t.splice(e,1)[0]),t}(this.itemOrderArr,o,i)).forEach(function(t){var e=r.indexOf(t);n.filter('[order-item="item_'.concat(t,'"]')).attr("order-index",e).css("order",e)}),this.itemOrderArr=r,this.initItemOrder(!0))},finishMoveItem:function(t){var e=p(t.target),o=this.$element,i=o.find(d).not(y),n=o.find(c),r=i.find(f),s=i.find(_);e.hide(),s.hide(),o.find(a).show(),n.show(),r.show()},startMoveItem:function(t){var e=p(t.target),o=this.$element,i=o.find(d).not(y),n=o.find(c),r=i.find(f),s=i.find(_);if(!i.length)return!1;e.hide(),o.find(l).show(),s.show(),n.hide(),r.hide(),this.initItemOrder()},destroy:function(){this.unbind(),this.$element.removeData(n)}},v.DEFAULTS={},v.OPTION_HTML='<option value="[[selectorPosition]]" [[#isSelected]]selected[[/isSelected]]>[[selectorPosition]] of [[itemTotal]]</option>',v.plugin=function(i){return this.each(function(){var t,e=p(this),o=e.data(n);if(!o){if(/destroy/.test(i))return;e.data(n,o=new v(this,i))}"string"==typeof i&&p.isFunction(t=o[i])&&t.apply(o)})},p(function(){var e='[data-toggle="qor.collection.sortable"]';p("body").data(i)||(p("body").data(i,!0),p(document).on("disable.qor.collection.sortable",function(t){v.plugin.call(p(e,t.target),"destroy")}).on(t,function(t){v.plugin.call(p(e,t.target))}).triggerHandler(t))}),v});